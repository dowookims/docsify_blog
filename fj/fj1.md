# 함수형 자바스크립트 1

###### 2019.07.04

## 성공적인 프로그래밍이란?

모든 프로그래밍 패러다임은 성공적인 프로그래밍을 위해 존재하는데, 성공적인 프로그래밍은 좋은 프로그램을 만드는 일입니다.

좋은 프로그램이란 사용성, 성능, 확장성, 기획 변경에 대한 대응력 등이 좋은 것을이야기 하며, 이를 효율적이고 생산적으로 이루는 일이 성공적인 프로그래밍 입니다.



## 함수형 프로그래밍

함수형 프로그래밍은 성공적인 프로그래밍을 위해 부수효과(side effect)를 배제하고 조합성을 강조하는 프로그래밍입니다.

사이드 이펙트를 배제한다는 것은 순수 함수를 만든다는 것이고, 순수함수란 수학적인 함수, 사이드 이펙트가 없는 함수 입니다. 순수함수란 인자가 같으면 동일한 결과를 반환하며 주위 상태, 환경에 영향을 미치지 않는 것을 의미합니다.

그리고 리턴값 외에는 외부와 소통하지 않는것이 특징입니다.



조합성을 강조한다는 것은 모듈화 수준을 높인다는 것이며, 순수 함수로 조합성을 강조하면 오류를 줄이고 안정성을 높이는 것이며, 모듈화 수준이 높다는 것은 생산성을 높인다는 것이고 성공적인 프로그래밍(좋은 프로그래밍)이다.



```js
function add(a,b){
  return a+b
}
// 동일한 인자를 주면 동일한 결과를 반환하며
// 외부 상태에 영향을 미치지 않는다.
```

```js
var c = 10;
function add2(a, b){
  return a+b+c;
}
// c가 변하게 된다면 순수함수가 아니며
// c 가 상수이면 순수함수가 된다.
```

```js
var c = 20;
function add3(a, b){
  c = b;
  return a+b;
}
// 부수효과(side effect)가 존재하며 순수함수가 아니다.
// return외에 다른 코드들이 외부의 상태에 영향을 미치면(값을 변화한다면)이는 사이드 이펙트가 존재한다고 이야기 한다.
```

함수형 프로그래밍의 경우 인자로 사용하는 객체들을 직접 변형하지 않고, 사용해야 할 인자의 복사본을 사용하여 복사본을 변화하며 외부의 상태에 영향을 끼치지 않으려는 프로그래밍이다.

```js
var obj1 = { val: 10 };
function add4(obj, b){
  return { val: obj.val + b}
}
// 인자로 받은 것을 변경하지 않으며, 외부 환경을 변경 하지도 않는 순수함수이다.
```



함수형 프로그래밍의 경우 값을 변형해 나가거나 값을 다룰 때 초기화된 값을 변화시키지 않고, 외부의 상태를 변경시키지 않고, 값을 직접 수정하지 않고 복사본을 가지고 작업을 진행한다.



또한, 순수함수는 평가 시점이 중요하지 않다. 이것이 함수형 프로그래밍이 가능한 중요한 개념이며 이유이다. 값이 변화됨에 따라 평가되는 시점이 존재하는데, 그 시점에 따라 내부 로직이 변하게 된다면 이는 순수함수가 아니며, 순수함수는 어느 시점에서도 같은 결과를 반환하기 때문에(인자가 같다면)  평가 시점을 개발자가 다룰 수 있게 된다.



이래서 안전하고, 개발하기 편한 함수를 사용하여 성공적인 프로그래밍을 할 수 있게 된다.



## 일급함수

일급함수란 함수를 값으로 다룰 수 있다는 것이다. 함수를 변수에 담을 수 있고, 변수에 담은 함수가 값으로 다뤄질 수 있기 때문에 인자로 함수를 보내고, 이를 다른 함수에서 사용 할 수 있다는 것이다.

런타임에서 정의할 수 있고 사용할 수 있고, 인자로 사용할 수 있고, 원할 때 평가 할 수 있는 것을 일급함수라고 한다.



```js
var f1 = function(a) { return a * a};
console.log(f1) // function(a) { return a * a}, 함수의 내용이 보인다. 변수에 함수를 담을 수 있다.

var f2 = f1
console.log(f2) // function(a) { return a * a}

function f3(f){
  return f();
}
f3(function(){ return 10}); // 10
```

순수함수로 값을 저장하고, 유지하며, 필요할 때 평가한다면 개발 용이성이 상당히 증가하게 된다.



```js
// 순수함수와 일급 함수를 섞어서 사용한다면
function add_maker(a){
  return function(b){
    return a + b;
  }
}

var add10 = add_maker(10);
/* add10 = function(b){
	return 10 +b
} 
그래서 add10(20)을 하면 30이 리턴됨.
*/
// 이 함수는 클로져 함수로써, a = 10이라는 값을 기억하고 있다.


console.log( add10(20)); // 30
```

위 함수는 클로져이기도 한데, `function(b){ return a+ b}` 이 부분이 클로져이다.

`add_maker(a)` 함수는 a라는 변수를 사용하는 맥락을 가지고 있기 때문에,  

 var add10 = `add_maker(10)`  은 a가 10 이라는 것을 기억(참조)하면서 `function(b){ return a + b}` 을 가지고 있다. 즉, a 를 기억하면서 add10에 리턴 되어진다.

일급함수 이면서, 클로져 함수 이면서, 순수함수, 무려 세가지 기능의 콤비네이션을 가진 하이퍼 함수

함수를 값으로 다루면서, 순수 함수를 정의하면서 , 함수의 평가의 시점을 자유롭게 하며 다양한 방식으로 함수를 평가하는 이런 프로그래밍 방식을 함수형 프로그래밍이라고 한다.



```js
function f4(f1, f2, f3){
  return f3(f1() + f2());
}

f4(
  function(){ return 2;},
  function(){ return 1;},
  function(a) { return a * a; }
) // return 9;
```

함수형 프로그래밍은 이처럼 동작하는 프로그래밍이다. 이런 방식으로 띄게 되는데 프론트엔드 라이브러리들을 보면 이런 식으로 정의하거나 사용되기도 한다.



함수가 원하는 시점에 평가하고, 원하는 인자를 받아둔 함수에 적용하면서 로직을 완성해 나가는 것이 함수형 프로그래밍의 특징.



비동기가 일어나는 시점이나 동시성이 필요할 때 까지 함수의 평가를 늦추다가 필요 할때 받아 둔 함수를 실행하는 로직을 구현하기도 한다.



## 왜 함수형 프로그래밍이 대두되고 있는가?

요즘 개발은 실시간 동작이 되어야 하고, 유저들이 재미를 느껴야 한다.(메신저, 실시간 댓글, 라이브 방송, 협업 등)



또한 독창성과 완성도가 높아야 하는데, 사용자들의 이목을 집중시킬만한 애니메이션이나 특정한 유저 경험을 주어야 하는데, 무한 스크롤이나, 벽돌 형태의 리스트(핀터레스트 등), 사진을 누르면 사진이 켜지고 등등 다양한  UI / UX들을 제공한다.



모바일 시대가 되면서 웹 이용 시간이 많아졌는데, 어떤 서비스를 만들더라도 사용자들이 인터넷 사용 시간이 늘어나다보니 동시간에 많이 접속해서 사용한다. 사용자가 많이 늘어났기에 부하 뿐만 아니라, 이들의 동시적 행동에 대한 것들도 고려해야 한다.(비동기 I/O, CSP, Actor, STM)

전세계 사람들이 동시에 접속해서 많은 사용량을 쓰면서도, 사람들에게 끊김없이 해결해주기 위한 것들을 다뤄야 한다. 작은 자원으로 최대한 많은 처리를 할 수 있게.



더 빨라야 하는 반응성, 고가용성을 가져야 하는데, 절대 죽어서는 안되고 빠른 반응성으로. Scaling이 되어야 한다. 

예를들어, 전세계 사람들이 사용하고 있으니 점검 중이라고 하면 안된다. 이럴 때 죽지 않고 서비스가 계속 유지 되면서 작용되어야 하며, 죽어도 바로 다시 다른 서버를 살려주며 ELB, Auto Scaling, OTP Supervisor 등을 통해 사용자들에 대한 반응을 해야한다.



또한 어떤 서비스를 만들더라도 데이터의 정확성, 사용자에게 정확한 값들을 만들어 보여줘야 하기 때문에, 선호도에 따른 추천, 등으로 더많은 데이터와 분석으로 사용자들에게 적합하고 정확한 컨텐츠를 제공해야 한다. Map Reducer, Clousre의 병렬 처리, 동시에 데이터를 많이, 빨르 처리해야 하는 시대이다.



그렇지만, 타협할 수 없는 생산성을 고려해야 하는데, 작은 서비스를 만들더라도 이런 부분을 고려해야 하기 때문에 힘들수밖에 없다. 그러나 생산성을 포기해서는 안되고, 이를 유지하는게 성공적인 프로그래밍이 된다.

예전에는 하나의 프레임워크가 모든 것을 다 동작시켰다면, 요즘은 세밀한 도구들을 모아 작업을 한다. 성능도 사용성, 완성도, 창의성 들이 중요시하므로 개발자들은 이를 잘 다루어야 한다.



이렇게 사용자의 눈높이가 높아지고, 회사의 기술력이 높아지는 동안 한쪽에서는 함수형 프로그래밍이 나타나는데, 하드웨어 성능이 좋아지고 컴파일러가 우아해지면서 함수형 프로그래밍 기술등이 소개되며 좋아지는 분산 / 리액티브 환경에서 동시성과 병렬성 관련 기술을 처리해야 하기 때문에 함수형 언어들이 더더욱 두드러지게 되고 있다.

또한 성공적인 적용 사례와 이들이 영향을 주니 함수형 프로그래밍 라이브러리와 해결책들이 채택되면서 FP 가 화두되고 있다.



마이클 포거스 [ 클로저 프로그래밍의 즐거움 ] 에서 함수형 프로그래밍은 애플리케이션, 함수의 구성요소 더 나아가 언어 자체를 함수처럼 여기도록 만들고 이러한 함수 개념을 우선순위에 넣는것을 함수형 프로그래밍이라 하며



함수형 사고방식은 문제의 해결 방법을 동사(함수)들로 구성(조합)하는 것이라고 한다.

```js
duck.moveLeft() // OOP
// data design => make function
moveLeft(duck) // FP
// function design => make data set
```





그렇다면 함수형 프로그래밍을 어떻게 해야 할까?

그렇다면 어떻게 전환 했는가? 어떻게 전환 해 왔는가.

기존의 명령형 코드를 함수형 코드로 전환하면서 함수형 프로그래밍에 대해 이해해 보자.